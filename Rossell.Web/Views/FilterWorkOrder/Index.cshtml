@model Rossell.BusinessEntity.FilterWorkOrder

@{    
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.AntiForgeryToken()
@Html.ValidationSummary(true, "", new { @class = "text-danger" })
<form class="border rounded" method="post" id="FilterWorkOrderForm">
    <div class="input-group">
        <div id="infoMessage" class="alert font" style="display: none;">
            <p></p>
        </div>
    </div>
    <div class="form-group">
        <label>Inventory Group</label>
        @Html.DropDownListFor(model => model.InventoryGroupID, new SelectList(ViewBag.InventoryGroup, "ID", "CODE"), new { id = "cmbInventoryGroupID", @class = "form-control", placeholder = "Inventory Group" })

    </div>
    <div class="form-group">
        <label>Part Number</label>
        @Html.DropDownListFor(model => model.PartNumberID, new SelectList(ViewBag.PartNumber, "ID", "ITEMNO"), new { id = "cmbPartNumber", @class = "form-control", placeholder = "Part Number" })

    </div>
    <div class="form-group">
        <label>Work Order Start Time</label>
        @Html.TextBoxFor(model => model.MustStartDate, "{0:dd-MM-yyyy}", new { @class = "form-control datepicker", placeholder = "Work Order Start Time" })

    </div>
    <div class="form-group">
        <label>Expiry Date</label>
        @Html.TextBoxFor(model => model.ExpiryDate, "{0:dd-MM-yyyy}", new { @Value = ViewBag.ExpiryDate,  @class = "form-control datepicker", placeholder = "Expiry Date" })

    </div>
    <div class="form-group d-flex justify-content-end pt-2 mb-0">
        <input type="button" id="btnBack" name="btnBack" value="Back" class="btn btn-secondary btn-sm text-right" />
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="button" id="btnclear" name="btnBack" value="Clear" class="btn btn-info btn-sm text-right" />
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <input type="submit" value="Next" class="btn btn-primary btn-sm text-right" />

    </div>
</form>
<div class="spinner" style="display:none">
    <div class="center-div">
        <div class="inner-div">
            <div class="loader"></div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $('#MustStartDate').datepicker({
        weekStart: 1,
        autoclose: true,
        todayHighlight: true,
        format: 'dd-mm-yyyy'
    });

    $('#ExpiryDate').datepicker({
        weekStart: 1,
        autoclose: true,
        todayHighlight: true,
        format: 'dd-mm-yyyy'
    });
    //$('#MustStartDate').datepicker("setDate", new Date());
</script>
<script type="text/javascript">
    $(document).ready(function () {

        $('#btnBack').on('click', function () {            
            var url = '@Url.Action("Index", "Printer")';
            window.location.href = url;
        });


        $('#btnclear').on('click', function () {            
            $("#cmbInventoryGroupID").prop('selectedIndex', 0);
            $("#cmbPartNumber").prop('selectedIndex', 0);
            $("#cmbInventoryGroupID").trigger('change');     
            $("#MustStartDate").val('');
        });

        $("#cmbInventoryGroupID").change(function () {            
            $('.spinner').css('display', 'block');
            var partNumberList;
            $.ajax({
                type: "POST",
                url: "@Url.Action("FilterInventoryGroup", "FilterWorkOrder")",
                data: { inventoryGroupID: $("#cmbInventoryGroupID").val() },
                dataType: "json",
                async: false,
                success: function (data) {
                    $('.spinner').css('display', 'none');
                    partNumberList = data;
                },
                failure: function (data) {
                    $('.spinner').css('display', 'none');
                    result = false;
                },
                error: function (data) {
                    $('.spinner').css('display', 'none');
                    partNumberList = false;
                }
            });
            if (partNumberList != null && partNumberList.length > 0) {
                $('#cmbPartNumber').empty();
            }
            
            $.each(partNumberList, function (val, text) {
                $("#cmbPartNumber").append(
                    $('<option></option>').val(this.ID).html(this.ItemNo)
                );
            });
        });
    

        $.validator.setDefaults({
            submitHandler: function () {
                var parameters =
                {
                    InventoryGroupID: $("#cmbInventoryGroupID").val(),
                    PartNumberID: $("#cmbPartNumber").val(),
                    MustStartDate: $("#MustStartDate").val(),
                    ExpiryDate: $("#ExpiryDate").val(),
                }
                $('.spinner').css('display', 'block');
                $.ajax({
                    type: "POST",
                    url: "/FilterWorkOrder/Next",
                    data: { filterWorkOrder: parameters},
                    cache: false,
                    success: function (response) {
                        if (response == true) {
                            var url = '@Url.Action("Index", "WorkOrders")';
                            window.location.href = url;
                        }
                        else {
                            $('.spinner').css('display', 'none');
                            $('#infoMessage').addClass('alert-danger');
                            $('#infoMessage').text('Invalid UserName Or Password.');
                            $('#infoMessage').stop();
                            $('#infoMessage').slideDown();
                            $('#infoMessage').delay(3000).slideUp("slow");
                        }
                    },
                    failure: function (response) {
                        //  alert(response.responseText);
                        $('.spinner').css('display', 'none');
                    },
                    error: function (response) {
                        //alert(response.responseText);
                        $('.spinner').css('display', 'none');
                    }
                });
            }
        });
         $('#FilterWorkOrderForm').validate({
                rules: {
                    
                },
                messages: {                   
                },
                errorElement: 'span',
                errorPlacement: function (error, element) {
                    error.addClass('invalid-feedback');
                    element.closest('.input-group').append(error);
                },
                highlight: function (element, errorClass, validClass) {
                    $(element).addClass('is-invalid');
                },
                unhighlight: function (element, errorClass, validClass) {
                    $(element).removeClass('is-invalid');
                }
            });
        });

</script>